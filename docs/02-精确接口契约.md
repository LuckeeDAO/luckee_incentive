# Luckee Incentive ç²¾ç¡®æ¥å£å¥‘çº¦

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: Luckee Incentive (æ¿€åŠ±åˆçº¦)
- **ç‰ˆæœ¬**: v1.0
- **æ–‡æ¡£ç±»å‹**: ç²¾ç¡®æ¥å£å¥‘çº¦
- **æ ‡å‡†**: OpenAPI Specification 3.0
- **åˆ›å»ºæ—¥æœŸ**: 2024-01-XX
- **æœ€åæ›´æ–°**: 2024-01-XX

## ğŸ¯ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†Luckee Incentiveåˆçº¦çš„æ‰€æœ‰æ¥å£ï¼ŒåŒ…æ‹¬è¯·æ±‚/å“åº”æ ¼å¼ã€çŠ¶æ€ç ã€é”™è¯¯ç±»å‹å’Œæ•°æ®éªŒè¯è§„åˆ™ã€‚ä½œä¸ºAIä¹‹é—´ã€ç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´äº¤äº’çš„"æ³•å¾‹æ–‡ä¹¦"ï¼Œç¡®ä¿æ— ç¼é›†æˆã€‚

## ğŸ“¡ åˆçº¦æ¥å£è§„èŒƒ

### 1. å®ä¾‹åŒ–æ¥å£ (InstantiateMsg)

```yaml
openapi: 3.0.0
info:
  title: Luckee Incentive Contract API
  version: 1.0.0
  description: Luckee Incentiveæ¿€åŠ±åˆçº¦æ¥å£è§„èŒƒ

paths:
  /instantiate:
    post:
      summary: å®ä¾‹åŒ–åˆçº¦
      description: åˆ›å»ºæ–°çš„Luckee Incentiveåˆçº¦å®ä¾‹
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InstantiateMsg'
      responses:
        '200':
          description: å®ä¾‹åŒ–æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InstantiateResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    InstantiateMsg:
      type: object
      required:
        - admin
        - ft_contract
        - registry_contract
        - config
      properties:
        admin:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: ç®¡ç†å‘˜åœ°å€
          example: "luckee1abc123..."
        ft_contract:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: FTåˆçº¦åœ°å€
          example: "luckee1ft123..."
        registry_contract:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: æ³¨å†Œåˆçº¦åœ°å€
          example: "luckee1reg123..."
        config:
          $ref: '#/components/schemas/ContractConfig'

    ContractConfig:
      type: object
      required:
        - enabled
        - emergency_paused
      properties:
        enabled:
          type: boolean
          description: ç³»ç»Ÿæ˜¯å¦å¯ç”¨
          example: true
        emergency_paused:
          type: boolean
          description: æ˜¯å¦ç´§æ€¥æš‚åœ
          example: false

    InstantiateResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        contract_address:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          example: "luckee1jkl012..."
        config:
          $ref: '#/components/schemas/ContractConfig'
```

### 2. æ‰§è¡Œæ¥å£ (ExecuteMsg)

```yaml
  /execute:
    post:
      summary: æ‰§è¡Œåˆçº¦æ“ä½œ
      description: æ‰§è¡Œæ¿€åŠ±ç›¸å…³æ“ä½œ
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExecuteMsg'
      responses:
        '200':
          description: æ‰§è¡ŒæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExecuteResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: æƒé™ä¸è¶³
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    ExecuteMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/DistributeRewardMsg'
        - $ref: '#/components/schemas/MintForPointsMsg'
        - $ref: '#/components/schemas/UpdateRulesMsg'
        - $ref: '#/components/schemas/RegisterContractMsg'
        - $ref: '#/components/schemas/AdminMsg'

    DistributeRewardMsg:
      type: object
      required:
        - distribute_reward
      properties:
        distribute_reward:
          type: object
          required:
            - activity_type
            - user
            - activity_data
          properties:
            activity_type:
              type: string
              enum: ["blind_box_open", "nft_mint", "voting", "referral_reward", "special_event"]
              description: æ´»åŠ¨ç±»å‹
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€
            activity_data:
              type: object
              description: æ´»åŠ¨ç›¸å…³æ•°æ®
              properties:
                value:
                  type: string
                  description: æ´»åŠ¨ä»·å€¼
                metadata:
                  type: object
                  description: æ´»åŠ¨å…ƒæ•°æ®
            event_id:
              type: string
              description: äº‹ä»¶IDï¼ˆå¯é€‰ï¼‰
              nullable: true

    MintForPointsMsg:
      type: object
      required:
        - mint_for_points
      properties:
        mint_for_points:
          type: object
          required:
            - user
            - points_amount
          properties:
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€
            points_amount:
              type: string
              pattern: '^[0-9]+$'
              minimum: "1000"
              description: ç§¯åˆ†æ•°é‡

    UpdateRulesMsg:
      type: object
      required:
        - update_rules
      properties:
        update_rules:
          type: object
          required:
            - rules
            - version
          properties:
            rules:
              $ref: '#/components/schemas/RewardRules'
            version:
              type: integer
              minimum: 1
              description: è§„åˆ™ç‰ˆæœ¬å·

    RegisterContractMsg:
      type: object
      required:
        - register_contract
      properties:
        register_contract:
          type: object
          required:
            - contract_address
            - contract_type
            - permissions
          properties:
            contract_address:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: åˆçº¦åœ°å€
            contract_type:
              type: string
              enum: ["blind_box", "nft", "voting", "registry"]
              description: åˆçº¦ç±»å‹
            permissions:
              type: array
              items:
                type: string
                enum: ["distribute_reward", "query_points", "mint_tokens"]
              description: æƒé™åˆ—è¡¨

    AdminMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/UpdateConfigMsg'
        - $ref: '#/components/schemas/EmergencyPauseMsg'

    UpdateConfigMsg:
      type: object
      required:
        - update_config
      properties:
        update_config:
          type: object
          required:
            - config
          properties:
            config:
              $ref: '#/components/schemas/ContractConfig'

    EmergencyPauseMsg:
      type: object
      required:
        - emergency_pause
      properties:
        emergency_pause:
          type: object
          required:
            - paused
          properties:
            paused:
              type: boolean
              description: æ˜¯å¦æš‚åœ

    RewardRules:
      type: object
      required:
        - activity_rules
        - referral_rules
        - level_multipliers
      properties:
        activity_rules:
          type: array
          items:
            type: object
            properties:
              activity_type:
                type: string
                enum: ["blind_box_open", "nft_mint", "voting", "referral_reward", "special_event"]
              base_reward:
                type: string
                pattern: '^[0-9]+$'
              multiplier:
                type: string
                pattern: '^[0-9]+\.[0-9]+$'
              enabled:
                type: boolean
        referral_rules:
          type: object
          properties:
            direct_rate:
              type: string
              pattern: '^0\.[0-9]+$'
            level_2_rate:
              type: string
              pattern: '^0\.[0-9]+$'
            level_3_rate:
              type: string
              pattern: '^0\.[0-9]+$'
        level_multipliers:
          type: object
          properties:
            Bronze:
              type: string
              pattern: '^[0-9]+\.[0-9]+$'
            Silver:
              type: string
              pattern: '^[0-9]+\.[0-9]+$'
            Gold:
              type: string
              pattern: '^[0-9]+\.[0-9]+$'
            Platinum:
              type: string
              pattern: '^[0-9]+\.[0-9]+$'

    ExecuteResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        transaction_hash:
          type: string
          description: äº¤æ˜“å“ˆå¸Œ
          example: "0x1234567890abcdef..."
        events:
          type: array
          items:
            $ref: '#/components/schemas/Event'
          description: äº‹ä»¶åˆ—è¡¨
```

### 3. æŸ¥è¯¢æ¥å£ (QueryMsg)

```yaml
  /query:
    post:
      summary: æŸ¥è¯¢åˆçº¦çŠ¶æ€
      description: æŸ¥è¯¢æ¿€åŠ±ç›¸å…³ä¿¡æ¯
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryMsg'
      responses:
        '200':
          description: æŸ¥è¯¢æˆåŠŸ
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/RewardHistoryResponse'
                  - $ref: '#/components/schemas/SystemStatsResponse'
                  - $ref: '#/components/schemas/ConfigResponse'
                  - $ref: '#/components/schemas/RegisteredContractsResponse'
        '400':
          description: è¯·æ±‚å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    QueryMsg:
      type: object
      oneOf:
        - $ref: '#/components/schemas/RewardHistoryQuery'
        - $ref: '#/components/schemas/SystemStatsQuery'
        - $ref: '#/components/schemas/ConfigQuery'
        - $ref: '#/components/schemas/RegisteredContractsQuery'

    RewardHistoryQuery:
      type: object
      required:
        - get_reward_history
      properties:
        get_reward_history:
          type: object
          required:
            - user
          properties:
            user:
              type: string
              pattern: '^luckee[a-z0-9]{38}$'
              description: ç”¨æˆ·åœ°å€
            limit:
              type: integer
              minimum: 1
              maximum: 1000
              description: è¿”å›æ•°é‡é™åˆ¶
              default: 50
            offset:
              type: integer
              minimum: 0
              description: åç§»é‡
              default: 0
            activity_type:
              type: string
              enum: ["blind_box_open", "nft_mint", "voting", "referral_reward", "special_event"]
              description: æ´»åŠ¨ç±»å‹è¿‡æ»¤ï¼ˆå¯é€‰ï¼‰
              nullable: true

    SystemStatsQuery:
      type: object
      required:
        - get_system_stats
      properties:
        get_system_stats:
          type: object
          properties:
            period:
              type: string
              enum: ["daily", "weekly", "monthly", "all"]
              description: ç»Ÿè®¡å‘¨æœŸ
              default: "all"

    ConfigQuery:
      type: object
      required:
        - get_config
      properties:
        get_config:
          type: object
          description: æŸ¥è¯¢åˆçº¦é…ç½®

    RegisteredContractsQuery:
      type: object
      required:
        - get_registered_contracts
      properties:
        get_registered_contracts:
          type: object
          description: æŸ¥è¯¢æ³¨å†Œçš„åˆçº¦

    RewardHistoryResponse:
      type: object
      properties:
        reward_history:
          type: array
          items:
            type: object
            properties:
              timestamp:
                type: integer
                description: æ—¶é—´æˆ³
              activity_type:
                type: string
                description: æ´»åŠ¨ç±»å‹
              amount:
                type: string
                pattern: '^[0-9]+$'
                description: å¥–åŠ±é‡‘é¢
              event_id:
                type: string
                nullable: true
                description: äº‹ä»¶ID
              transaction_hash:
                type: string
                description: äº¤æ˜“å“ˆå¸Œ
        total_rewards:
          type: string
          pattern: '^[0-9]+$'
          description: æ€»å¥–åŠ±
        total_count:
          type: integer
          description: æ€»æ•°é‡

    SystemStatsResponse:
      type: object
      properties:
        total_rewards_distributed:
          type: string
          pattern: '^[0-9]+$'
          description: æ€»åˆ†å‘å¥–åŠ±
        total_users:
          type: integer
          description: æ€»ç”¨æˆ·æ•°
        total_activities:
          type: integer
          description: æ€»æ´»åŠ¨æ•°
        activity_breakdown:
          type: object
          properties:
            blind_box_open:
              type: integer
              description: ç›²ç›’å¼€å¥–æ¬¡æ•°
            nft_mint:
              type: integer
              description: NFTé“¸é€ æ¬¡æ•°
            voting:
              type: integer
              description: æŠ•ç¥¨æ¬¡æ•°
            referral_reward:
              type: integer
              description: æ¨èå¥–åŠ±æ¬¡æ•°
            special_event:
              type: integer
              description: ç‰¹æ®Šæ´»åŠ¨æ¬¡æ•°
        average_reward_per_user:
          type: string
          pattern: '^[0-9]+$'
          description: å¹³å‡æ¯ç”¨æˆ·å¥–åŠ±
        top_reward_users:
          type: array
          items:
            type: object
            properties:
              user:
                type: string
                pattern: '^luckee[a-z0-9]{38}$'
                description: ç”¨æˆ·åœ°å€
              total_rewards:
                type: string
                pattern: '^[0-9]+$'
                description: æ€»å¥–åŠ±
              activity_count:
                type: integer
                description: æ´»åŠ¨æ¬¡æ•°

    ConfigResponse:
      type: object
      properties:
        config:
          $ref: '#/components/schemas/ContractConfig'
        admin:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: ç®¡ç†å‘˜åœ°å€
        ft_contract:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: FTåˆçº¦åœ°å€
        registry_contract:
          type: string
          pattern: '^luckee[a-z0-9]{38}$'
          description: æ³¨å†Œåˆçº¦åœ°å€

    RegisteredContractsResponse:
      type: object
      properties:
        contracts:
          type: array
          items:
            type: object
            properties:
              contract_address:
                type: string
                pattern: '^luckee[a-z0-9]{38}$'
                description: åˆçº¦åœ°å€
              contract_type:
                type: string
                enum: ["blind_box", "nft", "voting", "registry"]
                description: åˆçº¦ç±»å‹
              permissions:
                type: array
                items:
                  type: string
                  enum: ["distribute_reward", "query_points", "mint_tokens"]
                description: æƒé™åˆ—è¡¨
              registered_at:
                type: integer
                description: æ³¨å†Œæ—¶é—´æˆ³
        total_count:
          type: integer
          description: æ€»åˆçº¦æ•°
```

### 4. é”™è¯¯å“åº”è§„èŒƒ

```yaml
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: é”™è¯¯ä»£ç 
              example: "UNAUTHORIZED"
            message:
              type: string
              description: é”™è¯¯æ¶ˆæ¯
              example: "è°ƒç”¨è€…æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ"
            details:
              type: object
              description: é”™è¯¯è¯¦æƒ…
              properties:
                field:
                  type: string
                  description: é”™è¯¯å­—æ®µ
                  example: "user"
                value:
                  type: string
                  description: é”™è¯¯å€¼
                  example: "luckee1invalid..."
                suggestion:
                  type: string
                  description: ä¿®å¤å»ºè®®
                  example: "ä½¿ç”¨æœ‰æ•ˆçš„ç”¨æˆ·åœ°å€"

    ErrorCodes:
      type: object
      properties:
        UNAUTHORIZED:
          type: object
          properties:
            code: "UNAUTHORIZED"
            message: "è°ƒç”¨è€…æ— æƒé™æ‰§è¡Œæ­¤æ“ä½œ"
            http_status: 401
        USER_NOT_FOUND:
          type: object
          properties:
            code: "USER_NOT_FOUND"
            message: "ç”¨æˆ·ä¸å­˜åœ¨"
            http_status: 404
        UNSUPPORTED_ACTIVITY:
          type: object
          properties:
            code: "UNSUPPORTED_ACTIVITY"
            message: "ä¸æ”¯æŒçš„æ´»åŠ¨ç±»å‹"
            http_status: 400
        SYSTEM_PAUSED:
          type: object
          properties:
            code: "SYSTEM_PAUSED"
            message: "ç³»ç»Ÿå·²æš‚åœ"
            http_status: 503
        REWARD_CALCULATION_FAILED:
          type: object
          properties:
            code: "REWARD_CALCULATION_FAILED"
            message: "å¥–åŠ±è®¡ç®—å¤±è´¥"
            http_status: 500
        MINT_FAILED:
          type: object
          properties:
            code: "MINT_FAILED"
            message: "ä»£å¸é“¸é€ å¤±è´¥"
            http_status: 500
        INSUFFICIENT_POINTS:
          type: object
          properties:
            code: "INSUFFICIENT_POINTS"
            message: "ç§¯åˆ†ä¸è¶³"
            http_status: 400
        INVALID_RULES:
          type: object
          properties:
            code: "INVALID_RULES"
            message: "æ— æ•ˆçš„è§„åˆ™é…ç½®"
            http_status: 400
        CONTRACT_ALREADY_EXISTS:
          type: object
          properties:
            code: "CONTRACT_ALREADY_EXISTS"
            message: "åˆçº¦å·²å­˜åœ¨"
            http_status: 400
```

## ğŸ”’ æ•°æ®éªŒè¯è§„åˆ™

### 1. åœ°å€éªŒè¯

```yaml
address_validation:
  pattern: '^luckee[a-z0-9]{38}$'
  description: "Luckeeåœ°å€æ ¼å¼éªŒè¯"
  examples:
    valid: "luckee1abc123def456ghi789jkl012mno345pqr678stu901vwx234"
    invalid: "cosmos1abc123..." # é”™è¯¯çš„åœ°å€å‰ç¼€
    invalid: "luckee1abc" # åœ°å€é•¿åº¦ä¸è¶³
```

### 2. ç§¯åˆ†æ•°é‡éªŒè¯

```yaml
points_validation:
  pattern: '^[0-9]+$'
  minimum: "1000"
  maximum: "1000000000000000000"
  description: "ç§¯åˆ†æ•°é‡éªŒè¯"
  examples:
    valid: "1000000" # 100ä¸‡ç§¯åˆ†
    valid: "1000" # æœ€å°å•ä½
    invalid: "999" # ä½äºæœ€å°å€¼
    invalid: "1000000000000000001" # è¶…è¿‡æœ€å¤§å€¼
    invalid: "1.5" # ä¸èƒ½æœ‰å°æ•°
    invalid: "-1000000" # ä¸èƒ½ä¸ºè´Ÿæ•°
```

### 3. æ´»åŠ¨ç±»å‹éªŒè¯

```yaml
activity_type_validation:
  enum: ["blind_box_open", "nft_mint", "voting", "referral_reward", "special_event"]
  description: "æ´»åŠ¨ç±»å‹éªŒè¯"
  examples:
    valid: "blind_box_open"
    valid: "nft_mint"
    invalid: "invalid_activity" # ä¸æ”¯æŒçš„æ´»åŠ¨ç±»å‹
```

### 4. åˆçº¦ç±»å‹éªŒè¯

```yaml
contract_type_validation:
  enum: ["blind_box", "nft", "voting", "registry"]
  description: "åˆçº¦ç±»å‹éªŒè¯"
  examples:
    valid: "blind_box"
    valid: "nft"
    invalid: "invalid_contract" # ä¸æ”¯æŒçš„åˆçº¦ç±»å‹
```

## ğŸ“Š çŠ¶æ€ç æ˜ å°„

```yaml
status_code_mapping:
  success:
    http_status: 200
    cosmwasm_status: "success"
    description: "æ“ä½œæˆåŠŸ"
  
  bad_request:
    http_status: 400
    cosmwasm_status: "failure"
    description: "è¯·æ±‚å‚æ•°é”™è¯¯"
    error_codes:
      - "UNSUPPORTED_ACTIVITY"
      - "INSUFFICIENT_POINTS"
      - "INVALID_RULES"
      - "CONTRACT_ALREADY_EXISTS"
  
  unauthorized:
    http_status: 401
    cosmwasm_status: "failure"
    description: "æƒé™ä¸è¶³"
    error_codes:
      - "UNAUTHORIZED"
  
  not_found:
    http_status: 404
    cosmwasm_status: "failure"
    description: "èµ„æºä¸å­˜åœ¨"
    error_codes:
      - "USER_NOT_FOUND"
  
  internal_server_error:
    http_status: 500
    cosmwasm_status: "failure"
    description: "å†…éƒ¨æœåŠ¡å™¨é”™è¯¯"
    error_codes:
      - "REWARD_CALCULATION_FAILED"
      - "MINT_FAILED"
  
  service_unavailable:
    http_status: 503
    cosmwasm_status: "failure"
    description: "æœåŠ¡ä¸å¯ç”¨"
    error_codes:
      - "SYSTEM_PAUSED"
```

## ğŸ”„ ç‰ˆæœ¬å…¼å®¹æ€§

```yaml
version_compatibility:
  current_version: "1.0.0"
  supported_versions:
    - "1.0.0"
  
  breaking_changes:
    v1.0.0:
      - "åˆå§‹ç‰ˆæœ¬å‘å¸ƒ"
      - "åŸºç¡€æ¿€åŠ±åŠŸèƒ½"
      - "å¤šåˆçº¦åè°ƒ"
  
  migration_guide:
    initial_deployment:
      - "é¦–æ¬¡éƒ¨ç½²æ— éœ€è¿ç§»"
      - "é…ç½®æ¿€åŠ±è§„åˆ™"
      - "æ³¨å†Œä¸šåŠ¡åˆçº¦"
```

## ğŸ“ å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2024-01-XX | åˆå§‹æ¥å£è§„èŒƒåˆ›å»º | AI Assistant |

---

**æ³¨æ„**: æœ¬æ–‡æ¡£æ˜¯AIä¹‹é—´ã€ç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´äº¤äº’çš„"æ³•å¾‹æ–‡ä¹¦"ï¼Œä»»ä½•æ¥å£å˜æ›´éƒ½å¿…é¡»åŒæ­¥æ›´æ–°æœ¬æ–‡æ¡£ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰ç›¸å…³æ–¹ã€‚
